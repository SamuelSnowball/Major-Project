<!DOCTYPE HTML>

<head>
	<title>WebGL Project</title>

	<link rel="stylesheet" href="code/css/gui.css">
	<link rel="stylesheet" href="libraries/jquery-ui-1.12.1.custom/jquery-ui.css">
	<script src="libraries/jquery-ui-1.12.1.custom/external/jquery/jquery.js"></script>
	<script src="libraries/jquery-ui-1.12.1.custom/jquery-ui.js"></script>

</head>


<body>

<link rel="stylesheet" href="code/css/gui.css">

<div id="banner"><p>Mars Mission Control Game</p></div>

<div>fps: <span id="fps"></span></div>

<!-- GL Canvas -->
<canvas id="canvas" class="canvasClass"></canvas>
  
  
  <div id="inventoryOverlayID" title="Inventory" style="visibility: hidden">
	<p>
		<table height="100%" width="100%">
		
		  <tr>
			<td id = "slot0" background="resources/rocks/empty.png">1</td>
			<td id = "slot1" background="resources/rocks/empty.png">23</td> 
			<td id = "slot2" background="resources/rocks/empty.png">23</td>
			<td id = "slot3" background="resources/rocks/empty.png">23</td>
		  </tr>         
							
		  <tr>             
			<td id = "slot4" background="resources/rocks/empty.png"></td>
			<td id = "slot5" background="resources/rocks/empty.png"></td> 
			<td id = "slot6" background="resources/rocks/empty.png"></td>
			<td id = "slot7" background="resources/rocks/empty.png"></td>
		  </tr>
		  
		</table>
	</p>
	
  </div>

<!-- ######################### -->
<!-- XP Bar --> 
<div id="xpBarID" style="visibility: hidden">Experience</div>
<!-- XP Bar --> 
<!-- ######################### -->


<!-- ######################### -->
<!-- Inventory Bar --> 
<div id="inventoryBarID" style="visibility: hidden">Inventory full! Deposit ores at lander</div>
<!-- Inventory Bar --> 
<!-- ######################### -->


<!-- ######################### -->
<!-- XP Bar --> 
<div id="healthBarID" style="visibility: hidden">Health</div>
<!-- XP Bar --> 
<!-- ######################### -->

<!-- ######################### -->
<!-- Prospecting Bar --> 
<div id="prospectingBarID" style="visibility: hidden">Prospecting...</div>
<!-- Prospecting Bar --> 
<!-- ######################### -->


<!-- ######################### -->
<!-- Deposit ore message --> 
<div id="depositOreID" style="visibility: hidden">Deposited ore!</div>
<!-- Deposit ore message --> 
<!-- ######################### -->

<!-- ######################### -->
<!-- OutOfBounds message --> 
<div id="outOfBoundsID" style="visibility: hidden">ALERT - Terrain too dangerous!</div>
<!-- OutOfBounds messagee --> 
<!-- ######################### -->

<!-- ######################### -->
<!-- Minimap --> 
<div id="minimapID" title="Minimap" style="visibility: hidden">
	<p>Map goes here.</p>
</div>
<!-- Minimap --> 
<!-- ######################### -->

 
<!-- ######################### -->
<!-- Nearest rock --> 
<div id="nearestRockID" title="Rock Information" style="visibility: hidden">
	<p>This is the default dialog which is useful for displaying information. The dialog window can be moved, resized and closed with the 'x' icon.</p>
</div>
<!-- Nearest rock --> 
<!-- ######################### -->

 
<!-- ######################### -->
<!-- Current mission --> 
<div id="currentMissionID" title="Current Mission" style="visibility: hidden">
	<p>This is the default dialog which is useful for displaying information. The dialog window can be moved, resized and closed with the 'x' icon.</p>
</div>
<!-- Current mission --> 
<!-- ######################### -->

	
	
<!-- ######################### -->
<!-- Menu --> 
<ul id="menu" style="visibility: hidden">

<li><div>Menu</div> <!-- Once clicked others should show -->
	<ul>
	
		<li><div>Help</div>
			<ul>
				<li><div>Press P to prospect</div></li>
			</ul>
		</li>
		
		<li><div>Sound</div></li>
		
		<li><div>Controls</div>
			<ul>
				<li><div>Invert controls</div></li>
			</ul>		
		</li>
		
		<li><div>About</div></li>
		
	</ul>
</li>	

<li><div>Missions</div>
	<ul>
	
		<li><div>Area 1 Missions</div>
			<ul>
				<li><div>Prospect a rock</div></li>
				<li><div>Prospect 8 rocks</div></li>
				<li><div>Deposit ore at lander</div></li>
			</ul>
		</li>
		
		<li class="ui-state-disabled"><div>Area 2 Missions</div></li>
		<li class="ui-state-disabled"><div>Area 3 Missions</div></li>
		<li class="ui-state-disabled"><div>Area 4 Missions</div></li>
		
	</ul>
</li>	
		

</ul>
<!-- Menu --> 	
<!-- ######################### -->




<!-- Libraries -->
<script src="libraries/m4.js"></script>
<script src="libraries/perlin.js"></script>
<script src="libraries/webgl-obj-loader.js"></script>



<!-- Not my js files-->
<script src="code/js/ImprovedNoise.js"></script>


<!-- Needs to be in this weird order -->
<script src="code/myJs/glSetup.js"></script>
<!-- This needs to be above matrices.js and below glSetup, and a texture object is created in matrices.js -->
<script src="code/myJs/TextureLoader.js"></script>

<script src="code/myJs/vertexShader.js"></script>
<script src="code/myJs/fragmentShader.js"></script>
<script src="code/myJs/program.js"></script>

<!-- Named properly -->
<script src="code/myJs/CollisionTester.js"></script>
<script src="code/myJs/Terrain.js"></script>
<script src="code/myJs/RockGenerator.js"></script>
<script src="code/myJs/GUI.js"></script>
<script src="code/myJs/LoadingScreen.js"></script>
<script src="code/myJs/ParticleSystem.js"></script>
<script src="code/myJs/WaterSystem.js"></script>
<script src="code/myJs/Player.js"></script>
<script src="code/myJs/MissionAssigner.js"></script>
<script src="code/myJs/Sound.js"></script>
<script src="code/myJs/Lander.js"></script>
<script src="code/myJs/Utility.js"></script>
<script src="code/myJs/WorldState.js"></script>

<!-- Needs naming -->
<script src="code/myJs/mouse.js"></script>
<script src="code/myJs/missions.js"></script>

<script>

var gameRunning = false;
var perlin = new ImprovedNoise();

//For saving the game
var gameTime = 0;
var saveTime = 100;

var textureLoader = new TextureLoader();
var utility = new Utility();
var loadingScreen = new LoadingScreen();


var player = new Player(5, 1, 5); 

var terrain = new Terrain();
var rockGenerator = new RockGenerator();

var worldState = new WorldState(); //Loads and saves the world
//var gui = new GUI();
var collisionTester = new CollisionTester();
var particleSystem = new ParticleSystem();

var waterSystem = new WaterSystem();
//var missionAssigner = new MissionAssigner();
var sound = new Sound();
var lander = new Lander();


//Taken
var fpsElement = document.getElementById("fps");
var then = Date.now() / 1000;  // get time in seconds
function render(){
	var now = Date.now() / 1000;  // get time in seconds
    var elapsedTime = now - then;
    then = now;
	var fps = 1 / elapsedTime;
    fpsElement.innerText = fps.toFixed(0); 

	gl.clearColor(0.8, 0.8, 0.8, 0.7);
	gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
	
	/*
	Auto-save the game every 20 seconds or so
	But only save if they're not in minimap mode
	Otherwise their Y position gets saved at 500
	*/
	if(gameTime === saveTime){
		if(useFog === true){
			//console.log("World auto saved");
			worldState.saveWorld();
			gameTime = 0;
		}
	}
	console.log("Player X, Y, Z: " + Math.floor(player.get.x) + ", " + Math.floor(player.get.y) + ", " + Math.floor(player.get.z));
	
	player.movePlayer();
	player.assignPlayerQuadrant();

	terrain.render(); 

	
	collisionTester.testPlayerMapBoundaries();
	collisionTester.setPlayerHeight(); 
	collisionTester.testPlayerRockCollision();

	rockGenerator.renderObjRocks();

	waterSystem.updateWaterVertices();
	waterSystem.render();

	//missionAssigner.checkOrAssignPlayerMissions();
	
	//gui.update();
	//gui.displayCurrentRock();
	//gui.renderInventory();
	
	lander.render();
	lander.depositPlayerOre();
	
	player.renderInventory();
	
	
	gameTime++;
	requestAnimationFrame(render);
}





/*
This gets called when the user clicks to start the game
*/
function setup(){
	gameRunning = true;
	clearInterval(loadingScreen.animateBackground); //LoadingScreen.js
	
	//worldState.loadWorld();
	//gui.setup();
	
	player.set.x = 200;
	player.set.y = 3;
	player.set.z = 200;

	render();
}

</script>


</body>
</html>