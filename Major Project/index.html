<!DOCTYPE HTML>

<head>
	<title>WebGL Project</title>
	
	<!-- Removes annoying scrollbars from window -->
	<style type="text/css">
		html, body {
		overflow: hidden;
	}
	
	#banner{
		width: 200px;
		height: 200px;
		margin: auto;
	}

	.container {
		position: relative;
		background-color: rgba(0, 0, 0, 0);
	}
	#overlay {
		position: absolute;
		left: 10px;
		top: 65%;
		background-color: rgba(0, 0, 0, 0.7);
		color: white;
		font-family: monospace;
		padding: 1em;
		border-radius: 1em;
		border: 5px solid #0000ff;
	}
	</style>
</head>

<!-- 
GUI
https://webglfundamentals.org/webgl/lessons/webgl-text-html.html
-->
<body>

<div id="banner"><p>Mars Mission Control Game</p></div>


<div class="container">
  <canvas id="canvas" class="canvasClass"></canvas>
  <canvas id="guiCanvas" class="canvasClass"></canvas>
  <div id="overlay" class="canvasClass" style="visibility: hidden">
    <div>Current position: <span id="playerPosition"></span></div>
    <div>X: <span id="playerX"></span></div>
	<div>Y: <span id="playerY"></span></div>
	<div>Z: <span id="playerZ"></span></div>
  </div>
</div>

<!-- Libraries 
<script src="libraries/mdn-webgl-master/library/matrices.js"></script> -->
<script src="libraries/m4.js"></script>
<script src="libraries/perlin.js"></script>
<script src="libraries/jquery-3.1.1.min.js"></script>
<script src="libraries/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>

<!-- Not my js files-->
<script src="code/js/ImprovedNoise.js"></script>

<!-- Needs to be in this weird order -->
<script src="code/myJs/glSetup.js"></script>
<script src="code/myJs/vertexShader.js"></script>
<script src="code/myJs/fragmentShader.js"></script>
<script src="code/myJs/program.js"></script>
<script src="code/myJs/projection.js"></script>
<script src="code/myJs/matrices.js"></script>

<script src="code/myJs/player.js"></script>
<script src="code/myJs/terrain.js"></script>
<script src="code/myJs/movement.js"></script>
<script src="code/myJs/mouse.js"></script>
<script src="code/myJs/collision.js"></script>
<script src="code/myJs/loadSave.js"></script>
<script src="code/myJs/rock.js"></script>
<script src="code/myJs/textureLoader.js"></script>
<script src="code/myJs/GUI.js"></script>
<script src="code/myJs/particles.js"></script>

<script>
document.body.style.backgroundImage = "url('/major-project/major project/resources/homeImage.png')";
document.body.style.backgroundRepeat = "no-repeat";

var backgroundXPos = 5;
var backgroundYPos = 5;



var movementSpeed = 3; 

var playerXRotation;
var playerYRotation;	

//For saving the game
var gameTime = 0;
var saveTime = 1200;

function render(){
	gl.clearColor(0, 0, 0, 0);
	gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
	
	var now = Date.now();
	
	/*
	Auto-save the game every 20 seconds or so
	*/
	if(gameTime === saveTime){
		console.log("World auto saved");
		saveWorldInfo();
		gameTime = 0;
	}
	
	console.log("Player X, Y, Z: " + Math.floor(playerX) + ", " + Math.floor(playerY) + ", " + Math.floor(playerZ));

	movePlayer(); //movement.js
	
	drawTerrain(); //terrain.js
	
	
	setPlayerHeight(); //collision.js
	testPlayerRockCollision();

	//drawSphere();
	//drawRock();
	
	drawRocks();

	drawParticles();
	
	drawCubeColliders();
	
	backgroundXPos+=0.1;
	backgroundYPos+=0.1;
	document.body.style.backgroundPosition = backgroundXPos + "%" + ' ' + backgroundYPos + "%";
	
    // set the nodes
    guiPlayerPositionNode.nodeValue = "";  // no decimal place
    guiXNode.nodeValue = Math.floor(playerX);   // 2 decimal places
	guiYNode.nodeValue = Math.floor(playerY);
	guiZNode.nodeValue = Math.floor(playerZ);
	
	gameTime++;
	requestAnimationFrame(render);
}


function setup(){
	setupGUI(); //gui.js
	 
	 
	setupCubeColliders();

	buildParticles();
	
	loadWorldInfo(); //loadSave.js

	setupMovement(); //movement.js
	loadAllTextures(); //textureLoader.js
	
	//all in terrain.js
	createHeightMap();
	fillHeightMap();
	
	//Disabled whilst fix textures
	createHills();
	createCraters();
	
	createTerrainVertices();
	setupTerrainBuffers();
	

	createRocks();
	setupRockBuffers();

		
	render();
}
setup();

</script>


</body>
</html>