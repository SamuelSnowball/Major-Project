<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Program.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Camera.html">Camera</a></li>
                                <li><a href="../classes/CollisionTester.html">CollisionTester</a></li>
                                <li><a href="../classes/MarsScene.html">MarsScene</a></li>
                                <li><a href="../classes/Minimap.html">Minimap</a></li>
                                <li><a href="../classes/MyGUI.html">MyGUI</a></li>
                                <li><a href="../classes/ParticleSystem.html">ParticleSystem</a></li>
                                <li><a href="../classes/PointerLockControls.html">PointerLockControls</a></li>
                                <li><a href="../classes/RockGenerator.html">RockGenerator</a></li>
                                <li><a href="../classes/Skybox.html">Skybox</a></li>
                                <li><a href="../classes/Terrain.html">Terrain</a></li>
                                <li><a href="../classes/Texture.html">Texture</a></li>
                                <li><a href="../classes/TextureLoader.html">TextureLoader</a></li>
                                <li><a href="../classes/Utility.html">Utility</a></li>
                                <li><a href="../classes/WaterSystem.html">WaterSystem</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/Engine.html">Engine</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: Program.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * This file currently handles:
 * 	Linking shaders into program
 * 	
 * 	Getting and enabling shader variables
 * 	
 * 	Global definition of matrices and camera matrix info
 * 	
 * 	The updateAttributesAndUniforms function to pull values from global matrices and values,
 * 	to update the shader values
 * 	
 * 	@module Engine
*/

/*
Program creation, attaching shaders, linking, printing errors
*/
var program = gl.createProgram();
gl.attachShader(program, vertexShader);
gl.attachShader(program, fragmentShader);
gl.linkProgram(program);
console.log(&quot;Link status: &quot; + gl.getProgramInfoLog(program));
gl.useProgram(program); 

/*
Global variables to change and load into shaders
*/
var clipPlane = [0, 0, 0, 0];
var skyColour = [0.0, 0.0, 0.0, 1.0]; //0.8, 0.5, 0.5, 0.7
var lightColour = [1, 1, 1];
var useFog = true;
var useInstancing = false;

/*
Camera matrices
*/
var UP_VECTOR = [0, 1, 0];
// Matrix for camera, move the camera in the world, then inverse and move world around camera
var cameraMatrix = m4.lookAt( [5,5,5], [0.5, 0.5, 0.5], UP_VECTOR );
// View matrix for camera, inverse everything, so that the camera is the origin
var viewMatrix = m4.inverse(cameraMatrix);

/*
Translation matrices and fullTransforms
*/
var scale = m4.scaling(0, 0, 0);
var rotateX = m4.xRotation(0);
var rotateY = m4.yRotation(0);
var rotateZ = m4.zRotation(0);
var position = m4.translation(0, 0, 0);

var fullTransforms = m4.identity();

/*
Projection variables and the matrix
*/
var fovInRadians = Math.PI * 0.3;	
var aspectRatio = window.innerWidth / window.innerHeight;
var zNear = 0.1;
var zFar = 512;

//Projection matrix turns world coordinates to clipspace
var projectionMatrix = 	m4.perspective(
	fovInRadians,
	aspectRatio,
	zNear,
	zFar
);

/*
Get location of variables in shaders, so we can send data to shaders
Enable them if needed
*/

// Model, passing in fullTransforms
var modelLocation = gl.getUniformLocation(program, &#x27;model&#x27;);
gl.uniformMatrix4fv(modelLocation, false, new Float32Array(fullTransforms));

// View matrix
var viewMatrixLocation = gl.getUniformLocation(program, &#x27;viewMatrix&#x27;);
gl.uniformMatrix4fv(viewMatrixLocation, false, new Float32Array(viewMatrix));

// Inverse view matrix
var inverseViewMatrixLocation = gl.getUniformLocation(program, &#x27;inverseViewMatrix&#x27;);
gl.uniformMatrix4fv(inverseViewMatrixLocation, false, new Float32Array(m4.inverse(viewMatrix)));

// Projection
var projectionLocation = gl.getUniformLocation(program, &#x27;projection&#x27;);
gl.uniformMatrix4fv(projectionLocation, false, new Float32Array(projectionMatrix));

// Vertices
var positionAttribLocation = gl.getAttribLocation(program, &#x27;position&#x27;);
gl.enableVertexAttribArray(positionAttribLocation);

// Uvs
var textureCoordLocation = gl.getAttribLocation(program, &quot;aTextureCoord&quot;);
gl.enableVertexAttribArray(textureCoordLocation);

// Normals
var normalAttribLocation = gl.getAttribLocation(program, &#x27;normal&#x27;);
gl.enableVertexAttribArray(normalAttribLocation);

// Light position, can remove this?
var lightPositionAttribLocation = gl.getUniformLocation(program, &#x27;lightPosition&#x27;);
gl.enableVertexAttribArray(lightPositionAttribLocation);

// Light color
var lightColourAttribLocation = gl.getUniformLocation(program, &#x27;lightColour&#x27;);
gl.enableVertexAttribArray(lightColourAttribLocation);

// Specular lighting, for use on textures
var shineDamperAttribLocation = gl.getUniformLocation(program, &#x27;shineDamper&#x27;);
gl.enableVertexAttribArray(shineDamperAttribLocation);

var reflectivityAttribLocation = gl.getUniformLocation(program, &#x27;reflectivity&#x27;);
gl.enableVertexAttribArray(reflectivityAttribLocation);

// Directional lighting
var reverseLightDirectionLocation = gl.getUniformLocation(program, &#x27;reverseLightDirection&#x27;);
gl.enableVertexAttribArray(reverseLightDirectionLocation);

// Lighting direction
var lightDirectionLocation = gl.getUniformLocation(program, &#x27;lightDirection&#x27;);
gl.enableVertexAttribArray(lightDirectionLocation);

// Sky colour for fog
var skyColourLocation = gl.getUniformLocation(program, &#x27;skyColour&#x27;);
gl.enableVertexAttribArray(skyColourLocation);

// Fog
var useFogLocation = gl.getUniformLocation(program, &#x27;useFog&#x27;);
gl.enableVertexAttribArray(useFogLocation);

// Instancing location for rocks
var useInstancingLocation = gl.getUniformLocation(program, &#x27;useInstancing&#x27;);
gl.enableVertexAttribArray(useInstancingLocation);	

// The 4 vec4s which are combined in the shader to give a matrix4
var instancingLocation0 = gl.getAttribLocation(program, &quot;instanceMatrixRow0&quot;);
var instancingLocation1 = gl.getAttribLocation(program, &quot;instanceMatrixRow1&quot;);
var instancingLocation2 = gl.getAttribLocation(program, &quot;instanceMatrixRow2&quot;);
var instancingLocation3 = gl.getAttribLocation(program, &quot;instanceMatrixRow3&quot;);

// Clipping planes for water rendering
var clipPlaneLocation = gl.getUniformLocation(program, &#x27;clipPlane&#x27;);
gl.enableVertexAttribArray(clipPlaneLocation);	

// For blending of the map boundaries
var alphaLocation = gl.getUniformLocation(program, &#x27;alpha&#x27;);
var useAlphaLocation = gl.getUniformLocation(program, &#x27;useAlpha&#x27;);

/*
Loads global variables and matrices into shaders every frame
*/
function updateAttributesAndUniforms(){

	fullTransforms = m4.multiply(position, rotateZ);
	fullTransforms = m4.multiply(fullTransforms, rotateY);
	fullTransforms = m4.multiply(fullTransforms, rotateX);
	fullTransforms = m4.multiply(fullTransforms, scale);
	
	gl.uniformMatrix4fv(modelLocation, false, new Float32Array(fullTransforms));
	gl.uniformMatrix4fv(viewMatrixLocation, false, new Float32Array(viewMatrix));
	gl.uniformMatrix4fv(inverseViewMatrixLocation, false, new Float32Array(m4.inverse(viewMatrix)));
	gl.uniformMatrix4fv(projectionLocation, false, new Float32Array(projectionMatrix));
	
	gl.uniform3fv(lightColourAttribLocation, lightColour);
	gl.uniform1f(shineDamperAttribLocation, currentTexture.getTextureAttribute.shineDamper);
	gl.uniform1f(reflectivityAttribLocation, currentTexture.getTextureAttribute.reflectivity);
	
	// Directional lighting, coming straight down
	gl.uniform3fv(reverseLightDirectionLocation, m4.normalize([0, -1, 0]));
	// For specular lighting, its the same as above...
	// This is the surfaceToLightVector, so yeah, it goes up!
	gl.uniform3fv(lightDirectionLocation, m4.normalize([0, 1, 0]));
	
	// Fog
	gl.uniform4fv(skyColourLocation, skyColour);
	
	// Enable/disable fog
	gl.uniform1i(useFogLocation, useFog);
	
	// Clip plane
	gl.uniform4fv(clipPlaneLocation, clipPlane);
}

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
